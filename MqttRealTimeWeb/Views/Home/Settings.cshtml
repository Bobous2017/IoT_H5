@{
    ViewData["Title"] = "Settings Dashboard";
}

<h2>Realtime Settings Data</h2>

<table id="settingsTable" class="table table-striped">
    <thead>
        <tr>
            <th>ID</th>
            <th>Device ID</th>
            <th>Start Hour</th>
            <th>End Hour</th>
            <th>Min Temp</th>
            <th>Max Temp</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>
<script>
    const connection = new signalR.HubConnectionBuilder()
        .withUrl("http://192.168.1.147:5000/sensorhub") // or https://192.168.1.147:7241
        .withAutomaticReconnect()
        .build();

        connection.on("NewSetting", function (setting) {
        console.log("✔ Received new setting from API", setting);

        const row = `<tr>
                <td>${setting.Id}</td>
                <td>${setting.deviceID}</td>
                <td>${setting.startHour}</td>
                <td>${setting.endHour}</td>
                <td>${setting.minTemp}</td>
                <td>${setting.maxTemp}</td>
            </tr>`;

        const tbody = document.querySelector("#settingsTable tbody");
        tbody.insertAdjacentHTML("afterbegin", row);

        if (tbody.rows.length > 10) {
            tbody.deleteRow(10);
        }
    });


    connection.on("BroadcastStatus", function (message) {
        console.log(message);
    });

    connection.start()
        .then(() => console.log("✅ Connected to API SignalR hub for Settings"))
        .catch(err => console.error("❌ Connection failed", err));
</script>
